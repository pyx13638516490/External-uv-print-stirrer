# ESP32 MicroPython 步進馬達控制器 (DM504T/57馬達)

這是一個使用 ESP32 開發板和 MicroPython 來控制 DM504T/DM5042 步進馬達驅動器的專案，主要用於驅動 57 型步進馬達。專案內包含兩種主要模式：一個可透過終端機互動控制的 Shell 模式，以及一個自動往復循環的展示模式。

---

## 專案簡介

本專案旨在提供一個簡單、易於理解且可高度客製化的步進馬達控制方案。使用者無需深入了解複雜的底層硬體控制，即可透過高階的 MicroPython 程式碼實現對步進馬達的精確控制，包括方向、步數（角度）和速度。

## 功能特色

* **基於 MicroPython:** 程式碼簡潔易讀，開發快速。
* **硬體相容性:** 專為常見的 DM504T/DM5042 驅動器和 57 步進馬達設計。
* **雙模式操作:**
    1.  **互動式 Shell (`shell_controller.py`):** 透過序列埠終端（如 Thonny、PuTTY）輸入指令，即時控制馬達運動，非常適合測試和調校。
    2.  **自動循環 (`auto_loop_controller.py`):** 上電後自動執行預設的往復運動（正轉N圈、反轉N圈），適合產品展示或重複性任務。
* **易於配置:** 所有關鍵參數（GPIO腳位、馬達細分、速度等）都在程式碼開頭清晰定義，方便修改。

## 硬體需求

| 組件 | 規格/說明 |
| :--- | :--- |
| 微控制器 | ESP32 開發板 (任何版本均可) |
| 步進馬達驅動器 | DM504T, DM5042 或其他相容的 PUL/DIR 介面驅動器 |
| 步進馬達 | NEMA 23 (57型) 步進馬達 |
| 直流電源供應器 | 24V - 48V (根據您的驅動器和馬達規格選擇) |
| 連接線 | 杜邦線或其他電子連接線 |

## 軟體需求

* **MicroPython 韌體:** 您的 ESP32 需要先燒錄好 MicroPython 韌體。 [點此前往官方網站下載](https://micropython.org/download/esp32/)
* **開發工具:** 一個能與 ESP32 溝通的工具，推薦使用 [Thonny IDE](https://thonny.org/)，它內建了檔案管理和 REPL Shell，非常方便。

## 硬體接線

**警告：請務必在所有設備都斷電的情況下進行接線！錯誤的接線可能會損壞您的設備。**

**核心原則：ESP32 的 `GND` 必須與驅動器的訊號地 `GND` 連接（共地）。**

| ESP32 腳位 | DM504T 驅動器端子 | 說明 |
| :--- | :--- | :--- |
| `GND` | `PUL-` | 脈衝訊號地 |
| `GND` | `DIR-` | 方向訊號地 |
| `GND` | `ENA-` (可選) | 使能訊號地 |
| `GPIO 2` (可改) | `PUL+` | 脈衝訊號輸入 |
| `GPIO 4` (可改) | `DIR+` | 方向訊號輸入 |
| `GPIO 5` (可改) | `ENA+` (可選) | 使能訊號輸入 |

**電源接線:**

* **驅動器電源:** 將直流電源供應器的 `+` 和 `-` 分別接到驅動器的 `VCC` 和 `GND` 端子。
* **馬達接線:** 將步進馬達的四條線 (A+, A-, B+, B-) 連接到驅動器對應的輸出端子。

## 驅動器設定 (DIP 開關)

在 DM504T 驅動器上，您需要透過 DIP 開關設定**電流**和**細分**。

1.  **電流 (Current):** 根據您馬達的額定電流來設定，通常選擇略低於或等於額定電流的檔位。
2.  **細分 (Pulse/Rev):** 設定每轉一圈需要的脈衝數。此設定會影響馬達的平滑度和解析度。本專案中的範例 (`25000`, `6400`) 都需要您在驅動器上設定對應的檔位。

**請務必參考您的驅動器手冊來確定 DIP 開關的正確位置。**

## 安裝與使用

1.  **燒錄韌體:** 確保您的 ESP32 已安裝 MicroPython。
2.  **上傳檔案:** 使用 Thonny IDE 將本專案的 `.py` 檔案上傳到 ESP32 的根目錄。
3.  **選擇模式:**
    * 若要使用 **互動式 Shell**，請將 `shell_controller.py` 重新命名為 `main.py`。
    * 若要使用 **自動循環模式**，請將 `auto_loop_controller.py` 重新命名為 `main.py`。
4.  **重新啟動:** 按下 ESP32 上的 `EN` 或 `RST` 按鈕，`main.py` 將會自動執行。

### 模式一：互動式 Shell (`shell_controller.py`)

連接到 Thonny 的 Shell 或其他序列埠終端後，您會看到幫助選單。

**可用指令:**

* `move <steps> <direction> <speed>`: 控制馬達運動。
    * `<steps>`: 步數 (例如: `6400` 代表一圈，若驅動器設為6400細分)
    * `<direction>`: 方向 ( `0` 或 `1` )
    * `<speed>`: 速度 ( `1`-`100` )
    * **範例:** `move 6400 0 50`
* `enable`: 使能驅動器 (鎖定馬達)。
* `disable`: 禁用驅動器 (釋放馬達)。
* `help`: 顯示幫助訊息。

### 模式二：自動往復循環 (`auto_loop_controller.py`)

此模式無需互動。您可以直接在檔案的頂部修改參數來改變馬達的行為：

```python
# --- 參數設定 ---
STEPS_PER_REVOLUTION = 25000 # 根據您的驅動器細分設定
REVOLUTIONS = 2              # 每次轉動的圈數
SPEED_LEVEL = 75             # 運行速度 (1-100)
DELAY_SECONDS = 2            # 換向前的停頓時間 (秒)